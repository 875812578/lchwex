# 作用域

作用域的概念来源于系统栈的使用方式，以及它用于临时变量存储的方式。了解作用域的概念才能理解变量在哪里创建，存在以及销毁。


# extern关键字

extern可以置于变量或者函数前，以标示变量或者函数的定义在别的文件中，提示编译器遇到此变量和函数时在其他模块中寻找其定义。此外extern也可用来进行链接指定。

也就是说extern有两个作用，第一个,当它与"C"一起连用时，如: extern "C" void fun(int a, int b);则告诉编译器在编译fun这个函数名时按着C的规则去翻译相应的函数名而不是C++的，C++的规则在翻译这个函数名时会把fun这个名字变得面目全非，可能是fun@aBc_int_int#%$也可能是别的，这要看编译器的"脾气"了(不同的编译器采用的方法不一样)，为什么这么做呢，因为C++支持函数的重载啊，在这里不去过多的论述这个问题，如果你有兴趣可以去网上搜索，相信你可以得到满意的解释!

第二，当extern不与"C"在一起修饰变量或函数时，如在头文件中: extern int g_Int; 它的作用就是声明函数或全局变量的作用范围的关键字，其声明的函数和变量可以在本模块活其他模块中使用，记住它是一个声明不是定义!也就是说B模块(编译单元)要是引用模块(编译单元)A中定义的全局变量或函数时，它只要包含A模块的头文件即可,在编译阶段，模块B虽然找不到该函数或变量，但它不会报错，它会在连接时从模块A生成的目标代码中找到此函数。

# static 关键字

static （文件中）

某种意义上可以说是extern的反义词， 意思是变量只能在当前.c文件中使用。

static （函数中）

如果你使用static在函数中声明变量，它和文件中的static定义类似，但只能在该函数中使用。很少用。

# 为了避免与栈相关的bug，写C代码的时候需要遵循的规则

1. 不要隐藏某个变量，就像ex22_main中scope_demo中对count所做的那样。这可能会产生一些bug，你认为你改变了某个变量，其实没有。
2. 避免过多的全局变量，尤其是跨越多个文件。如果必须的话，要使用set/get函数。但并不适合常量，因为它是只读的。
3. 如果不知道变量该放哪，就放到堆上吧，直接用malloc创建它。
4. 不要使用函数级的静态变量，比如update_ratio。在多线程环境下有影响。
5. 避免复用函数参数。
